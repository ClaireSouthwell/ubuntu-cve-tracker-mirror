#!/usr/bin/env python
# Dumps the Ubuntu-Descriptions in a form suitable for a USN announcement
# Copyright (C) 2008 Canonical, Ltd.
# Author: Kees Cook <kees@ubuntu.com>
# License: GPLv3
import sys, os, debian_bundle.deb822
import textwrap

empty = set()
for cve in sys.argv[1:]:
    if cve == "--cve":
        continue
    filename = "active/" + cve
    if os.path.exists(filename):
        chunks = debian_bundle.deb822.Deb822(file(filename))
        desc = chunks['Ubuntu-Description'].strip()
        if len(desc) == 0:
            desc = chunks['Description'].strip()
        desc = desc.replace('\n',' ').replace('   ',' ').replace('  ',' ')
        if len(desc) == 0:
            empty.add(cve)
    else:
        desc = "XXX-FIXME-XXXX"
    if len(sys.argv[1:])!=1:
        desc += " (%s)"%cve
        print
    print textwrap.fill(desc,75)

if len(empty):
    print "Empty: %s" % (" ".join(sorted(empty)))
    sys.exit(1)
