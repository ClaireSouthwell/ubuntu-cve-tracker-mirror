SCRIPTS=$(shell echo $$SCRIPTS)
TARGET=$(shell echo $$TARGET)

CVEFILES:=$(wildcard CVE-*)
CVES := $(foreach cve,$(CVEFILES),$(TARGET)/$(word 2,$(subst -, ,$(cve)))/$(cve).html)
YEARS := $(sort $(foreach cve,$(CVEFILES),$(word 2,$(subst -, ,$(cve)))))

BZR_COMMIT:=$(shell bzr log --limit=1 --line | cut -d: -f1)

all:: $(CVES)

$(foreach year,$(YEARS),$(TARGET)/$(year)/CVE-%.html): CVE-% $(SCRIPTS)/html_export.py
	mkdir -p $(dir $@)
	$(SCRIPTS)/html-export-cve.py --commit $(BZR_COMMIT) $< > $@.tmp
	mv $@.tmp $@
