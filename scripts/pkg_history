#!/bin/sh

# Author: Jamie Strandboge <jamie@ubuntu.com>
# Copyright (C) 2013 Canonical Ltd.
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 2 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.

set -e

if [ "$1" = "-h" ]; then
        echo "./scripts/pkg_history [-f] pkgname1 pkgname2 ..."
        exit 0
fi

if [ -z "$1" ]; then
	echo "Need to specific a source package name"
	exit 1
fi

showfull="no"
if [ "$1" = "-f" ]; then
        shift
        showfull="yes"
fi

for pkg in "$@"; do
    echo "= $pkg ="
    for d in retired ignored active ; do
        for cve in `grep "_$pkg: " ./$d/* | \
            cut -d ':' -f 1 | \
            cut -d '/' -f 3 | \
            sort -u` ; do
            if [ "$showfull" = "yes" ]; then
                echo ""
                cat "./$d/$cve"
                echo ""
            else
                echo "$cve"
            fi
        done
    done
    if [ "$showfull" = "no" ]; then
        echo ""
    fi
done
