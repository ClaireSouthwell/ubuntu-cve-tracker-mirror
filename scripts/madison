#!/usr/bin/python
# Really simple madison-like reporting tool that uses source_map data for
# reporting.  Note that it only reports the highest version's entry for
# a given source pkg's release.
#
# Copyright 2008, Canonical Ltd.
# Author: Kees Cook <kees@ubuntu.com>
# Author: Jamie Strandboge <jamie@ubuntu.com>
import sys
import cve_lib

import source_map
source = source_map.load()

answer = source_map.madison(source, sys.argv[1])

for name in sorted(answer.keys()):
    rel, component = name.split('/',1)
    pocket=''
    if '-' in rel:
        rel, pocket = rel.split('-',1)
    for pkg in sorted(answer[name].keys()):
        suffix=""
        if component in ['main','restricted'] and not cve_lib.is_supported(source, pkg, rel):
            suffix = "[unsupported]"
        print '%s | %s | %s%s' % (pkg, answer[name][pkg], name, suffix)
