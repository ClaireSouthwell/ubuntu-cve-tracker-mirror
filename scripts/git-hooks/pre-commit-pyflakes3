#!/bin/bash

# This hook will inspect pyflakes3 warnings on the python files to be
# committed. The hook should exit with non-zero status after issuing an
# appropriate message to the user asking wether to ignore the warnings or
# not.

MODIFIED_FILES=$(git diff --name-only --cached)
WARNINGS=0
for file in ${MODIFIED_FILES}
do
    IS_PYTHON_SCRIPT=$(file $file |grep "Python script")
    if [[ $IS_PYTHON_SCRIPT != "" ]] ;
    then
        # see if we should use pyflakes or pyflakes3
        if head -n1 $file | grep -Eq "(python3|pytest-3)" ; then
          pyflakes3 $file
        else
          pyflakes $file
        fi
        WARNINGS=$((WARNINGS + $?))
    fi
done

if [[ $WARNINGS -gt 0 ]];
then
    read -p 'Found pyflakes3 warnings. Enter "ignore" to continue or anything else to exit: ' answer < /dev/tty
    if ! [ "${answer}" = "ignore" ] ; then
        exit 1
    fi
fi

