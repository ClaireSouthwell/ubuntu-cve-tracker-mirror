#!/bin/sh
set -e
#
# Usage:
# ./scripts/cve_status CVE-XXXX-XXXX CVE-XXXX-XXXX
#

if [ "$1" = "-h" ]; then
	echo "./scripts/cve_status [-s] CVE-XXXX-XXXX CVE-XXXX-XXXX ..."
	exit 0
fi

just_status=
if [ "$1" = "-s" ]; then
	shift || true
	just_status="yes"
fi

if [ -z "$1" ]; then
	echo "Need to specify a CVE"
	exit 1
fi

for c in "$@"
do
	c=`echo $c | sed 's/,//g'`
	if [ -s "./retired/${c}" ]; then
		echo "$c (retired)"
		if [ -z "$just_status" ]; then
			echo ""
			cat ./retired/$c
			echo ""
		fi
	elif [ -s "./ignored/${c}" ]; then
		echo "$c (ignored)"
		if [ -z "$just_status" ]; then
			echo ""
			cat ./ignored/$c
			echo ""
		fi
	elif fgrep -q "$c" ./ignored/not-for-us.txt ; then
		echo "$c (not for us)"
	elif [ -s "./active/$c" ]; then
		./scripts/ubuntu-table --supported 2>/dev/null | egrep "($c|[[:space:]]+dapper)"
		if [ -z "$just_status" ]; then
			echo ""
			cat ./active/$c
			echo ""
		fi
	else
		echo "$c (not found)"
	fi
done

