#!/bin/bash
# Handy script to duplicate the status of a package(s) from one release to
# another where it is listed as DNE originally

# Primarily to use in the case where a package gets added to a release
# where it previously was DNE - and then we get a heap of errors from
# check-syntax like:

# package 'foo' DOES exist in 'bar'!

src="$1"
shift
if [ -z "$src" ]; then
  echo "Which release to copy status from?" >&2
  exit 1
fi
dst="$1"
shift
if [ -z "$dst" ]; then
  echo "Which release to copy status to?" >&2
  exit 1
fi

for pkg in "$@"; do
  echo "Duplicating status from ${src} to ${dst} for ${pkg} where was DNE for ${dst}"
  # find files to change
  files=$(grep -l '^'"${dst}_${pkg}"': DNE' active/00boilerplate* active/CVE-* retired/CVE-*)
  sed -i -e '/^'"${dst}_${pkg}"': DNE/d' ${files}
  perl -pi -e 's/^((#?)'"${src}_${pkg}"': (.*))/''$1\n$2'"${dst}_${pkg}"': $3/g' ${files}
done
