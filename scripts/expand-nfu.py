#!/usr/bin/env python
# Parses the not-for-us.txt file to extract CVEs
# Copyright (C) 2008 Canonical, Ltd.
# Author: Kees Cook <kees@ubuntu.com>
# License: GPLv3
import sys, os, subprocess

exporter = sys.argv[1]
target   = sys.argv[2]

def write_cve(cve, note):
    filename = '%s.ignored' % (cve)
    cvehtml = '%s/%s.html' % (target, cve)
    file(filename,'w').write('''Candidate: %s
Notes:
 %s
''' % (cve, note))
    subprocess.call([exporter,filename], stdout = file(cvehtml,'w'))
    os.unlink(filename)

for nfulist in sys.argv[3:]:
    for line in file(nfulist):
        remaining = line.strip()
        while len(remaining)>0:
            cve, remaining = remaining.split(' ',1)
            #print '[%s][%s]' % (cve,remaining)
            if cve.startswith("CVE"):
                note = "Does not apply to software found in Ubuntu"
                if remaining.startswith('#') and len(remaining)>2:
                    note = remaining[2:]
                    remaining = ''
                write_cve(cve, note)
            if cve.startswith('#'):
                remaining = ''
