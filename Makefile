# To test this Makefile, just run "export TARGET=/path/to/output" before
# running "make" and output will be generated there.

export SCRIPTS=$(shell pwd)/scripts
export ACTIVE=$(shell pwd)/active

all: cves pkgs tables

prep:
	rsync -a $(SCRIPTS)/html-top/. $(TARGET)/

cves: prep
	$(MAKE) -C active
	$(MAKE) -C retired
	$(MAKE) -C ignored

pkgs: prep
	# Always regenerate the pkgs makefile, the next call will sort out
	# what has or has not changed.
	$(SCRIPTS)/generate-pkgs-makefile.py > $(TARGET)/.pkgs-makefile
	$(MAKE) -f $(TARGET)/.pkgs-makefile

tables: prep
	$(SCRIPTS)/html-report -d $(TARGET)
	$(SCRIPTS)/html-report -d $(TARGET) -S

.PHONY: prep cves pkgs tables
