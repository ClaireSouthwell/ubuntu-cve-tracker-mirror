#!/bin/bash
# Reports a terse numeric of CVEs that need attention for supported packages.

TABLE=$(./scripts/ubuntu-table -s "$@")
for category in SUPPORTED COMMERCIAL universe 
do
  if [ "x$category" = "xuniverse" ]; then
    filter="-v '(SUPPORTED|COMMERCIAL)'"
  else
    filter=$category
  fi

  OUT=""
  for prio in critical high medium low
  do
      COUNT=$(echo "$TABLE" | grep $filter | grep ' '"$prio"'$' | wc -l)
      if [ "$COUNT" -gt 0 ]; then
          if [ -n "$OUT" ]; then
              OUT="$OUT, "
          fi
          OUT="$OUT$COUNT $prio"
      fi
  done
  if [ -z "$OUT" ]; then
      OUT="none!  :)"
  else
      COUNT=$(echo "$TABLE" | grep $filter | cut -d" " -f2 | cut -d: -f1 | sort -u | wc -l)
      fmtcat=`echo $category | tr [A-Z] [a-z]`
      OUT="$OUT, in $COUNT $fmtcat package"
      if [ "$COUNT" -ne 1 ]; then
          OUT="${OUT}s"
      fi
  fi
  echo "CVEs pending: $OUT"
done
