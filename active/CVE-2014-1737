PublicDateAtUSN: 2014-05-11
Candidate: CVE-2014-1737
PublicDate: 2014-05-11
References:
 http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-1737
 http://www.ubuntu.com/usn/usn-2219-1
 http://www.ubuntu.com/usn/usn-2220-1
 http://www.ubuntu.com/usn/usn-2221-1
 http://www.ubuntu.com/usn/usn-2223-1
 http://www.ubuntu.com/usn/usn-2224-1
 http://www.ubuntu.com/usn/usn-2225-1
 http://www.ubuntu.com/usn/usn-2226-1
 http://www.ubuntu.com/usn/usn-2227-1
 http://www.ubuntu.com/usn/usn-2228-1
 http://www.ubuntu.com/usn/usn-2260-1
Description:
 The raw_cmd_copyin function in drivers/block/floppy.c in the Linux kernel
 through 3.14.3 does not properly handle error conditions during processing
 of an FDRAWCMD ioctl call, which allows local users to trigger kfree
 operations and gain privileges by leveraging write access to a /dev/fd
 device.

 First, raw_cmd_ioctl calls raw_cmd_copyin. This function kmallocs
 space for a floppy_raw_cmd structure and stores the resulting
 allocation in the "rcmd" pointer argument. It then attempts to
 copy_from_user the structure from userspace. If this fails, an early
 EFAULT return is taken.

 The problem is that even if the early return is taken, the pointer to
 the non-/partially-initialized floppy_raw_cmd structure has already
 been returned via the "rcmd" pointer. Back out in raw_cmd_ioctl, it
 attempts to raw_cmd_free this pointer.

 raw_cmd_free attempts to free any DMA pages allocated for the raw
 command, kfrees the raw command structure itself, and follows the
 linked list, if any, of further raw commands (a user can specify the
 FD_RAW_MORE flag to signal that there are more raw commands to follow
 in a single FDRAWCMD ioctl).

 So, a malicious user can send a FDRAWCMD ioctl with a raw command
 argument structure that has some bytes inaccessible (ie. off the end
 of an allocated page). The copy_from_user will fail but raw_cmd_free
 will attempt to process the floppy_raw_cmd as if it had been fully
 initialized by the rest of raw_cmd_copyin. The user can control the
 arguments passed to fd_dma_mem_free and kfree (by making use of the
 linked-list feature and specifying the target address as a
 next-in-list structure).
Ubuntu-Description:
 Matthew Daley reported a flaw in the handling of ioctl commands by the
 floppy disk driver in the Linux kernel. An unprivileged local user could
 exploit this flaw to gain administrative privileges if the floppy disk
 module is loaded.
Notes:
 jdstrand> android kernels (goldfish, grouper, maguro, mako and manta) are not
  supported on the Ubuntu Touch 13.10 preview kernels
 jdstrand> android kernels (flo, goldfish, grouper, maguro, mako and manta) are
  not supported on the Ubuntu Touch 14.04 preview kernels
Bugs:
 https://launchpad.net/bugs/1316729
Priority: high
Discovered-by:
Assigned-to: 

Patches_linux:
 break-fix: - ef87dbe7614341c2e7bfe8d32fcb7028cc97442c
upstream_linux: released (3.15~rc5)
lucid_linux: released (2.6.32-60.122)
precise_linux: released (3.2.0-63.95)
quantal_linux: pending (3.5.0-51.76)
saucy_linux: released (3.11.0-22.38)
trusty_linux: released (3.13.0-27.50)
utopic_linux: not-affected (3.15.0-1.5)
vivid_linux: not-affected (3.16.0-23.31)
devel_linux: not-affected (3.19.0-15.15)

Patches_linux-ec2:
upstream_linux-ec2: released (3.15~rc5)
lucid_linux-ec2: released (2.6.32-364.77)
precise_linux-ec2: DNE
quantal_linux-ec2: DNE
saucy_linux-ec2: DNE
trusty_linux-ec2: DNE
utopic_linux-ec2: DNE
vivid_linux-ec2: DNE
devel_linux-ec2: DNE

Patches_linux-mvl-dove:
upstream_linux-mvl-dove: released (3.15~rc5)
lucid_linux-mvl-dove: ignored (reached end-of-life)
precise_linux-mvl-dove: DNE
quantal_linux-mvl-dove: DNE
saucy_linux-mvl-dove: DNE
trusty_linux-mvl-dove: DNE
utopic_linux-mvl-dove: DNE
vivid_linux-mvl-dove: DNE
devel_linux-mvl-dove: DNE

Patches_linux-ti-omap4:
upstream_linux-ti-omap4: released (3.15~rc5)
lucid_linux-ti-omap4: DNE
precise_linux-ti-omap4: released (3.2.0-1446.65)
quantal_linux-ti-omap4: pending (3.5.0-242.58)
saucy_linux-ti-omap4: released (3.5.0-242.58)
trusty_linux-ti-omap4: DNE
utopic_linux-ti-omap4: DNE
vivid_linux-ti-omap4: DNE
devel_linux-ti-omap4: DNE

Patches_linux-fsl-imx51:
upstream_linux-fsl-imx51: released (3.15~rc5)
lucid_linux-fsl-imx51: ignored (reached end-of-life, does not affect buildd)
precise_linux-fsl-imx51: DNE
quantal_linux-fsl-imx51: DNE
saucy_linux-fsl-imx51: DNE
trusty_linux-fsl-imx51: DNE
utopic_linux-fsl-imx51: DNE
vivid_linux-fsl-imx51: DNE
devel_linux-fsl-imx51: DNE

Patches_linux-linaro-omap:
upstream_linux-linaro-omap: released (3.15~rc5)
lucid_linux-linaro-omap: DNE
precise_linux-linaro-omap: ignored (abandoned)
quantal_linux-linaro-omap: ignored (abandoned)
saucy_linux-linaro-omap: DNE
trusty_linux-linaro-omap: DNE
utopic_linux-linaro-omap: DNE
vivid_linux-linaro-omap: DNE
devel_linux-linaro-omap: DNE

Patches_linux-linaro-shared:
upstream_linux-linaro-shared: released (3.15~rc5)
lucid_linux-linaro-shared: DNE
precise_linux-linaro-shared: ignored (abandoned)
quantal_linux-linaro-shared: ignored (abandoned)
saucy_linux-linaro-shared: DNE
trusty_linux-linaro-shared: DNE
utopic_linux-linaro-shared: DNE
vivid_linux-linaro-shared: DNE
devel_linux-linaro-shared: DNE

Patches_linux-linaro-vexpress:
upstream_linux-linaro-vexpress: released (3.15~rc5)
lucid_linux-linaro-vexpress: DNE
precise_linux-linaro-vexpress: ignored (abandoned)
quantal_linux-linaro-vexpress: ignored (abandoned)
saucy_linux-linaro-vexpress: DNE
trusty_linux-linaro-vexpress: DNE
utopic_linux-linaro-vexpress: DNE
vivid_linux-linaro-vexpress: DNE
devel_linux-linaro-vexpress: DNE

Patches_linux-qcm-msm:
upstream_linux-qcm-msm: released (3.15~rc5)
lucid_linux-qcm-msm: ignored (abandoned)
precise_linux-qcm-msm: ignored (abandoned)
quantal_linux-qcm-msm: ignored (abandoned)
saucy_linux-qcm-msm: DNE
trusty_linux-qcm-msm: DNE
utopic_linux-qcm-msm: DNE
vivid_linux-qcm-msm: DNE
devel_linux-qcm-msm: DNE

Tags_linux-armadaxp: not-ue
Patches_linux-armadaxp:
upstream_linux-armadaxp: released (3.15~rc5)
lucid_linux-armadaxp: DNE
precise_linux-armadaxp: released (3.2.0-1633.47)
quantal_linux-armadaxp: pending (3.5.0-1631.42)
saucy_linux-armadaxp: DNE
trusty_linux-armadaxp: DNE
utopic_linux-armadaxp: DNE
vivid_linux-armadaxp: DNE
devel_linux-armadaxp: DNE

Patches_linux-lts-quantal: DNE
upstream_linux-lts-quantal: released (3.15~rc5)
lucid_linux-lts-quantal: DNE
precise_linux-lts-quantal: released (3.5.0-51.76~precise1)
quantal_linux-lts-quantal: DNE
saucy_linux-lts-quantal: DNE
trusty_linux-lts-quantal: DNE
utopic_linux-lts-quantal: DNE
vivid_linux-lts-quantal: DNE
devel_linux-lts-quantal: DNE

Patches_linux-lts-raring:
upstream_linux-lts-raring: released (3.15~rc5)
lucid_linux-lts-raring: DNE
precise_linux-lts-raring: released (3.8.0-41.60~precise1)
quantal_linux-lts-raring: DNE
saucy_linux-lts-raring: DNE
trusty_linux-lts-raring: DNE
utopic_linux-lts-raring: DNE
vivid_linux-lts-raring: DNE
devel_linux-lts-raring: DNE

Patches_linux-lts-saucy:
upstream_linux-lts-saucy: released (3.15~rc5)
lucid_linux-lts-saucy: DNE
precise_linux-lts-saucy: released (3.11.0-22.38~precise1)
quantal_linux-lts-saucy: DNE
saucy_linux-lts-saucy: DNE
trusty_linux-lts-saucy: DNE
utopic_linux-lts-saucy: DNE
vivid_linux-lts-saucy: DNE
devel_linux-lts-saucy: DNE

Patches_linux-lts-trusty:
upstream_linux-lts-trusty: released (3.15~rc5)
lucid_linux-lts-trusty: DNE
precise_linux-lts-trusty: released (3.13.0-27.50~precise1)
quantal_linux-lts-trusty: DNE
saucy_linux-lts-trusty: DNE
trusty_linux-lts-trusty: DNE
utopic_linux-lts-trusty: DNE
vivid_linux-lts-trusty: DNE
devel_linux-lts-trusty: DNE

Patches_linux-goldfish:
upstream_linux-goldfish: released (3.15~rc5)
lucid_linux-goldfish: DNE
precise_linux-goldfish: DNE
quantal_linux-goldfish: DNE
saucy_linux-goldfish: ignored
trusty_linux-goldfish: ignored (was needed now end-of-life)
utopic_linux-goldfish: not-affected (3.4.0-3.17)
vivid_linux-goldfish: not-affected (3.4.0-4.23)
devel_linux-goldfish: not-affected (3.4.0-4.23)

Patches_linux-grouper:
upstream_linux-grouper: released (3.15~rc5)
lucid_linux-grouper: DNE
precise_linux-grouper: DNE
quantal_linux-grouper: DNE
saucy_linux-grouper: ignored
trusty_linux-grouper: needs-triage
utopic_linux-grouper: ignored (reached end-of-life)
vivid_linux-grouper: DNE
devel_linux-grouper: DNE

Patches_linux-maguro:
upstream_linux-maguro: released (3.15~rc5)
lucid_linux-maguro: DNE
precise_linux-maguro: DNE
quantal_linux-maguro: DNE
saucy_linux-maguro: ignored
trusty_linux-maguro: needs-triage
utopic_linux-maguro: DNE
vivid_linux-maguro: DNE
devel_linux-maguro: DNE

Patches_linux-mako:
upstream_linux-mako: released (3.15~rc5)
lucid_linux-mako: DNE
precise_linux-mako: DNE
quantal_linux-mako: DNE
saucy_linux-mako: ignored
trusty_linux-mako: ignored (was needed now end-of-life)
utopic_linux-mako: not-affected (3.4.0-5.31)
vivid_linux-mako: not-affected (3.4.0-5.34)
devel_linux-mako: not-affected (3.4.0-5.34)

Patches_linux-manta:
upstream_linux-manta: released (3.15~rc5)
lucid_linux-manta: DNE
precise_linux-manta: DNE
quantal_linux-manta: DNE
saucy_linux-manta: ignored
trusty_linux-manta: ignored (was needed now end-of-life)
utopic_linux-manta: not-affected (3.4.0-6.27)
vivid_linux-manta: not-affected (3.4.0-6.29)
devel_linux-manta: not-affected (3.4.0-6.29)

Patches_linux-flo:
upstream_linux-flo: released (3.15~rc5)
lucid_linux-flo: DNE
precise_linux-flo: DNE
quantal_linux-flo: DNE
saucy_linux-flo: DNE
trusty_linux-flo: ignored (was needed now end-of-life)
utopic_linux-flo: not-affected (3.4.0-3.12)
vivid_linux-flo: not-affected (3.4.0-3.15)
devel_linux-flo: not-affected (3.4.0-3.15)

Patches_linux-lts-utopic:
upstream_linux-lts-utopic: released (3.15~rc5)
lucid_linux-lts-utopic: DNE
precise_linux-lts-utopic: DNE
trusty_linux-lts-utopic: not-affected (3.16.0-25.33~14.04.2)
utopic_linux-lts-utopic: DNE
vivid_linux-lts-utopic: DNE
devel_linux-lts-utopic: DNE

Patches_linux-lts-vivid:
upstream_linux-lts-vivid: released (3.15~rc5)
lucid_linux-lts-vivid: DNE
precise_linux-lts-vivid: DNE
trusty_linux-lts-vivid: not-affected (3.19.0-18.18~14.04.1)
utopic_linux-lts-vivid: DNE
vivid_linux-lts-vivid: DNE
devel_linux-lts-vivid: DNE
