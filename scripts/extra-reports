#!/bin/bash
CVES=~/git-pulls/cve-tracker
HEADER='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head> <title>Ubuntu CVE Tracker</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="author" content="Canonical Ltd, Kees Cook and Jamie Strandboge" />
<meta name="description" content="Ubuntu CVE Tracker" />
<meta name="copyright" content="Canonical Ltd" />
<link rel="StyleSheet" href="toplevel.css" type="text/css" />
</head> <body> <div id="container">
<h2>Ubuntu CVE Tracker</h2> <h3>Introduction</h3>
<p class="intro">Ubuntu tracks its security vulnerabilities via the <a
href="https://launchpad.net/ubuntu-cve-tracker">Ubuntu CVE Tracker</a>. 
<p><a href="priority.html">Priority Color Key</a></p>'

FOOTER='<div id="footer"> &copy; Canonical Ltd. 2007-2017</div></body></html>'

pythonver=
# If we're running on lillypilly, python3-configobj isn't available, so
# use python2
if [ ! -f /usr/lib/python3/dist-packages/configobj.pyg ]; then
    pythonver=/usr/bin/python2
fi

cd $CVES
echo $HEADER > $TARGET/ubuntu-core-16.html
echo $HEADER > $TARGET/cloud-archive.html
$pythonver $SCRIPTS/ubuntu-table --html --only-release xenial  $(grep -v "^#" $CVES/ubuntu-core-supported.txt |  sed -e 's/^/-p /')  >> $TARGET/ubuntu-core-16.html
$pythonver $SCRIPTS/ubuntu-table --html $(grep -v "^#" $CVES/cloud-archive-supported.txt |  sed -e 's/^/-p /')  >> $TARGET/cloud-archive.html
echo $FOOTER >> $TARGET/ubuntu-core-16.html
echo $FOOTER >> $TARGET/cloud-archive.html
