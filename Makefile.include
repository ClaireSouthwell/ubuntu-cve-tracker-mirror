SCRIPTS=$(shell echo $$SCRIPTS)
TARGET=$(shell echo $$TARGET)

CVEFILES:=$(wildcard CVE-*)
CVES := $(foreach cve,$(CVEFILES),$(TARGET)/$(word 2,$(subst -, ,$(cve)))/$(cve).html)
YEARS := $(sort $(foreach cve,$(CVEFILES),$(word 2,$(subst -, ,$(cve)))))

GIT_COMMIT:=$(shell git rev-parse HEAD)

all:: $(CVES)

$(foreach year,$(YEARS),$(TARGET)/$(year)/CVE-%.html): CVE-% $(SCRIPTS)/html_export.py
	[ -d "$(dir $@)" ] || mkdir -p "$(dir $@)"
	$(SCRIPTS)/html-export-cve.py --commit $(GIT_COMMIT) $< > "$@.tmp"
	mv $@.tmp $@
