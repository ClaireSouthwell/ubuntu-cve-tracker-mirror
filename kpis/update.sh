#!/bin/bash
# Copyright (C) 2018 Canonical Ltd.
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 2 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.

# Master script to push all KPI data
set -e

# shellcheck source=common.sh
. "$(dirname "${BASH_SOURCE[0]}")/common.sh"

UCT=${UCT:-/home/ubuntu-security/git-pulls/cve-tracker}
export UCT

# move into the directory which contains this script
pushd $(dirname "${BASH_SOURCE[0]}")

debug "Pushing all data to prometheus / influx"

./push-published-usns.sh || error "Failed to push published USN data..."
./push-historic-cve-triage.sh || error "Failed to push historic CVE triage data..."
./push-cve-backlog.sh || error "Failed to push CVE backlog data..."
./push-mailing-list-subscribers.sh || error "Failed to push mailing list subscribers..."
./push-package-count.sh || error "Failed to push package counts..."
./push-package-cve-count.sh || error "Failed to push package CVE counts..."
./push-sponsor-todo.sh || error "Failed to push packages to be sponsored count..."
./push-mir-count.sh || error "Failed to push number of waiting MIRs..."
./push-supported-count.sh || error "Failed to push supported count..."
./push-usn-count.sh || error "Failed to push USN counts..."
./push-esm-package-count.sh || error "Failed to push ESM package counts..."

debug "Finished pushing all data to prometheus / influx"

popd
