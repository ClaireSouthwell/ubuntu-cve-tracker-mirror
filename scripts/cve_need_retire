#!/bin/bash

# Author: Jamie Strandboge <jamie@ubuntu.com>
# Author: Kees Cook <kees@ubuntu.com>
# Author: Marc Deslauriers <marc.deslauriers@ubuntu.com>
# Copyright (C) 2005-2018 Canonical Ltd.
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 2 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.

set -e

#
# Usage:
# ./scripts/cve_need_retire [-p]
#

cvedir="./active"

help() {
    cat <<EOM
Uasge: cve_need_retire [-f] [-p] [-u]"

  -f	full listing
  -p	list path to CVE
  -u	move the files to retired directory
  -h	this help statement
EOM
}

full=
update=
path=

while getopts "fhup" opt ; do
    case "$opt" in
        f) full="yes";;
        u) update="yes";;
        p) path="$cvedir/";;
        h) help ; exit 0;;
        ?) help
    esac
done

vcs=bzr
if [ -d ".git" ]; then
	vcs=git
fi

./scripts/ubuntu-table 2>&1 >/dev/null | grep '^retire: ' | while read junk cve
do
	if [ -z "$full" ]; then
		if [ -z "$update" ]; then
			echo "$path$cve"
		else
			$vcs mv -v "active/$cve" retired
		fi
	else
		cat "$cvedir/$cve"
		echo "--"
	fi
done

