#!/bin/bash

# Copyright (C) 2018 Canonical Ltd.
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 2 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.

# Sends the number of debdiffs awaiting sponsorship to prometheus for the KPIs
set -e

# shellcheck source=common.sh
. "$(dirname "${BASH_SOURCE[0]}")/common.sh"

pushd "$(dirname "${BASH_SOURCE[0]}")/.."
count=$(./scripts/report-todo-mir | tail -1 | cut -f1 -d" ")
popd

if [ "$count" ]; then
  timestamp=$(date -u +%s)
  DATA="assigned_mirs mirs=$count"
  push_to_influx "$DATA" "$timestamp"
else
  echo "Failed to get number of packages requiring sponsoring."
  exit 1
fi
