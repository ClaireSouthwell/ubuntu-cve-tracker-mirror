#!/bin/bash

# Copyright (C) 2018 Canonical Ltd.
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 2 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.

# Sends the number of updated packages per release to prometheus for the KPIs

cd $UCT

./scripts/fetch-db database.pickle.bz2

trusty_count=`./scripts/report-packages.py --action plot trusty | wc -l`
echo "security_packages_updated_trusty $trusty_count" | curl --data-binary @- http://push.security.kpi.internal:9091/metrics/job/security_job/instance/trusty_updates

xenial_count=`./scripts/report-packages.py --action plot xenial | wc -l`
echo "security_packages_updated_in_xenial $xenial_count" | curl --data-binary @- http://push.security.kpi.internal:9091/metrics/job/security_job/instance/xenial_updates

artful_count=`./scripts/report-packages.py --action plot artful | wc -l`
echo "security_packages_updated_artful $artful_count" | curl --data-binary @- http://push.security.kpi.internal:9091/metrics/job/security_job/instance/artful_updates
