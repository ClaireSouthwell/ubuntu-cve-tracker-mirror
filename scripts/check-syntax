#!/usr/bin/python
import glob, sys, optparse, cve_lib
import pprint

EXIT_FAIL = 1
EXIT_OKAY = 0

parser = optparse.OptionParser()
parser.add_option("-v", "--verbose", dest="verbose", help="Enable verbose reporting", action='store_true')
(opt, args) = parser.parse_args()

code = EXIT_OKAY

if len(args) == 0:
    for dir in ['active','retired','ignored']:
        args += sorted(glob.glob('%s/CVE-*' % (dir)))

for cve in args:
    ret, data = cve_lib.load_cve(cve)
    if ret == EXIT_FAIL:
        code = EXIT_FAIL
    elif opt.verbose:
        pp = pprint.PrettyPrinter(indent=4)
        pp.pprint(data)

if code == EXIT_OKAY and opt.verbose:
    print 'OK: %d CVEs' % (len(args))
sys.exit(code)
